# prisma-neighbourhood

Generate focused ERD diagrams from Prisma schemas by traversing relationships from any model to a configurable depth.

## Installation

### Run without installing (recommended)
bunx @matserdam/prisma-neighborhood [options]
bunx @matserdam/prisma-neighborhood [options]

### Install globally
npm install -g @matserdam/prisma-neighborhood

## Quick Start

# Visualize the neighborhood around User model
bunx @matserdam/prisma-neighborhood -s ./prisma/schema.prisma -m User

# Show only direct relationships (depth 1)
bunx @matserdam/prisma-neighborhood -s ./prisma/schema.prisma -m User -d 1

# Export as SVG (recommended for very large diagrams)
bunx @matserdam/prisma-neighborhood -s ./prisma/schema.prisma -m User -o docs/erd.svg

# Export as PNG for documentation
bunx @matserdam/prisma-neighborhood -s ./prisma/schema.prisma -m User -o docs/erd.png

## CLI Options

| Option | Alias | Description | Default |
|--------|-------|-------------|---------|
| --schema <path> | -s | Path to Prisma schema file | required |
| --model <name> | -m | Model to start traversal from | required |
| --depth <n> | -d | Number of relationship levels to traverse | 3 |
| --output <file> | -o | Output file (.mmd, .md, .svg, .png, .pdf) | stdout |
| --renderer <name> | -r | Diagram renderer to use | vector |
| --list-renderers | | Show available renderers | |
| --help | -h | Show help | |
| --version | -V | Show version | |

## Output Formats

| Extension | Format | Use Case |
|-----------|--------|----------|
| .mmd | Mermaid syntax | Embed in markdown, preview in VS Code, use mermaid.live |
| .md | Mermaid syntax | Same as .mmd |
| .svg | SVG vector | Best for large schemas, infinite zoom, transparent background |
| .png | PNG image (300 DPI) | README badges, Confluence, presentations, Slack |
| .pdf | PDF document | Print, formal architecture documentation |

### Export Pipeline

SVG, PNG, and PDF exports use @mermaid-js/mermaid-cli for accurate diagram rendering:

- **SVG**: Generated directly by mermaid-cli with transparent background
- **PNG**: SVG converted to high-resolution PNG (300 DPI) via sharp with white background
- **PDF**: High-DPI PNG embedded in PDF document via pdfkit

## Examples by Use Case

### Onboarding: Show a new developer just one domain
# Authentication domain only, not the full 200-model schema
bunx @matserdam/prisma-neighborhood -s schema.prisma -m User -d 2 -o docs/auth-domain.png

# Order processing domain for new backend developer
bunx @matserdam/prisma-neighborhood -s schema.prisma -m Order -d 2 -o docs/orders-domain.png

### Stakeholder communication: Generate diagrams for non-technical audience
bunx @matserdam/prisma-neighborhood -s prisma/schema.prisma -m Product -d 2 -o slides/product-model.png
bunx @matserdam/prisma-neighborhood -s prisma/schema.prisma -m Customer -d 2 -o slides/customer-model.pdf

### Impact analysis: See what models are affected by a change
# Before modifying User, see everything within 2 hops
bunx @matserdam/prisma-neighborhood -s schema.prisma -m User -d 2

# Check impact radius of Invoice changes
bunx @matserdam/prisma-neighborhood -s schema.prisma -m Invoice -d 2 -o impact-analysis.png

### Code review: Visualize models touched by a PR
# PR touches Order, OrderItem, Payment - see how they connect
bunx @matserdam/prisma-neighborhood -s schema.prisma -m Order -d 1 -o pr-context.png

### Domain-Driven Design: Identify bounded context boundaries
# Visualize neighborhood around each aggregate root
bunx @matserdam/prisma-neighborhood -s schema.prisma -m Order -d 3 -o contexts/order-aggregate.mmd
bunx @matserdam/prisma-neighborhood -s schema.prisma -m User -d 3 -o contexts/user-aggregate.mmd
bunx @matserdam/prisma-neighborhood -s schema.prisma -m Product -d 3 -o contexts/product-aggregate.mmd

### Check coupling: Does adding a relation create unwanted dependencies?
# Before: visualize Order neighborhood
bunx @matserdam/prisma-neighborhood -s schema.prisma -m Order -d 2 -o before.mmd
# After adding relation: check if UserPreferences now appears
bunx @matserdam/prisma-neighborhood -s schema.prisma -m Order -d 2 -o after.mmd

### Microservice decomposition: See what models cluster together
# What belongs in the Order service?
bunx @matserdam/prisma-neighborhood -s schema.prisma -m Order -d 3 -o services/order-service.png

# What belongs in the User service?
bunx @matserdam/prisma-neighborhood -s schema.prisma -m User -d 3 -o services/user-service.png

# Compare outputs to identify shared models (potential API boundaries)

### Database migration planning: Understand table dependencies
# What tables cascade from Product?
bunx @matserdam/prisma-neighborhood -s schema.prisma -m Product -d 3

# Plan migration order based on relationship graph
bunx @matserdam/prisma-neighborhood -s schema.prisma -m Inventory -d 2 -o migration-scope.png

### Documentation: Keep ERDs in sync with actual schema
# Regenerate focused diagrams from current schema
bunx @matserdam/prisma-neighborhood -s prisma/schema.prisma -m User -o docs/user-erd.png
bunx @matserdam/prisma-neighborhood -s prisma/schema.prisma -m Order -o docs/order-erd.png

# Generate Mermaid for embedding in README
bunx @matserdam/prisma-neighborhood -s prisma/schema.prisma -m Post -o README-diagram.mmd

### CI/CD: Automated documentation generation
# In GitHub Actions workflow
bunx @matserdam/prisma-neighborhood -s prisma/schema.prisma -m User -d 3 -o docs/generated/user-erd.png
bunx @matserdam/prisma-neighborhood -s prisma/schema.prisma -m Order -d 3 -o docs/generated/order-erd.png

## Understanding Depth

The --depth flag controls how many relationship levels to traverse from the starting model.

| Depth | What it shows |
|-------|---------------|
| 1 | Start model + directly related models only |
| 2 | Above + models related to those (2 hops) |
| 3 | Default. Good balance for most schemas |
| 4-5 | Deep exploration, may get large |

Example: User -> Post -> Comment -> Author

depth=1 shows: User, Post
depth=2 shows: User, Post, Comment
depth=3 shows: User, Post, Comment, Author

Use depth=1 for focused impact analysis.
Use depth=2-3 for domain understanding.
Use depth=4+ for exploring complex interconnections.

## Troubleshooting

### Export uses mermaid-cli
SVG/PNG/PDF export uses @mermaid-js/mermaid-cli which handles Puppeteer/Chromium automatically. No manual browser setup required.

### Model not found error
Model names are case-sensitive. Check exact spelling in your schema.prisma:

model User { ... }    # Use: -m User
model OrderItem { }   # Use: -m OrderItem (not orderitem)

### Diagram shows too many models
Reduce depth to limit scope:

# Too much? Try depth 1 for direct relations only
bunx @matserdam/prisma-neighborhood -s schema.prisma -m User -d 1

# Still too much? Your model may be a "God object" with too many relations

### Output is empty or missing models
Ensure the model has relations defined in your schema. Scalar-only models produce minimal output.

